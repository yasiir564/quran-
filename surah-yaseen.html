<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surah Yaseen</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amiri&family=Poppins:wght@300;400;500;600&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        :root {
    --primary-gradient: linear-gradient(135deg, #6e45e2, #88d3ce);
    --secondary-gradient: linear-gradient(135deg, #5e60ce, #6930c3);
    --text-color: #333;
    --light-text: #f8f9fa;
    --card-bg: rgba(255, 255, 255, 0.85);
    --shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    --border-radius: 12px;
    --ayah-card-bg: rgba(255, 255, 255, 0.2);
    --translation-bg: rgba(255, 255, 255, 0.3);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: #f8f9fa;
    color: var(--text-color);
    overflow-x: hidden;
    position: relative;
    min-height: 100vh;
}

/* Particles background */
#particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 30px 20px;
    position: relative;
    z-index: 1;
}

header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
}

.header-content {
    background: var(--primary-gradient);
    padding: 30px 20px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    transform: translateY(0);
    transition: transform 0.3s ease;
}

.header-content:hover {
    transform: translateY(-5px);
}

h1 {
    font-size: 3em;
    color: var(--light-text);
    margin: 0;
    font-weight: 600;
    letter-spacing: 1px;
    margin-bottom: 20px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

h2 {
    color: #5e60ce;
    margin-bottom: 15px;
    font-size: 1.8em;
    font-weight: 600;
}

.search-container {
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}

.search-container input {
    padding: 12px 20px;
    font-size: 1em;
    width: 100%;
    max-width: 400px;
    border: none;
    border-radius: 30px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    font-family: 'Poppins', sans-serif;
}

.search-container input:focus {
    outline: none;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
}

.search-container button {
    padding: 12px 25px;
    font-size: 1em;
    border: none;
    cursor: pointer;
    border-radius: 30px;
    background: var(--secondary-gradient);
    color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    font-family: 'Poppins', sans-serif;
}

.search-container button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

#dark-mode-toggle {
    cursor: pointer;
    font-size: 1.5em;
    color: var(--light-text);
    margin-top: 15px;
    display: inline-block;
    transition: transform 0.3s ease;
}

#dark-mode-toggle:hover {
    transform: rotate(30deg);
}

#surah-content {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 30px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
}

.ayah-container {
    margin-bottom: 30px;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    background: var(--ayah-card-bg);
}

.ayah-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
}

.ayah {
    font-family: 'Amiri', serif;
    font-size: 1.8em;
    line-height: 2.2em;
    text-align: right;
    padding: 25px;
    position: relative;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    transition: all 0.3s ease;
    background: transparent;
    border-bottom: 1px solid rgba(110, 69, 226, 0.1);
}

.ayah-number {
    position: absolute;
    top: 10px;
    left: 10px;
    background: var(--primary-gradient);
    color: var(--light-text);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Poppins', sans-serif;
    font-size: 0.8rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.ayah.playing {
    background: rgba(110, 69, 226, 0.1);
    box-shadow: 0 5px 15px rgba(110, 69, 226, 0.2);
}

.translation {
    font-size: 1.1em;
    line-height: 1.6em;
    text-align: left;
    color: #555;
    padding: 20px 25px;
    background: var(--translation-bg);
    border-radius: 0 0 var(--border-radius) var(--border-radius);
}

.audio-controls {
    padding: 0 25px 20px;
    background: var(--translation-bg);
}

.audio {
    display: block;
    width: 100%;
    margin: 0;
    border-radius: 30px;
    height: 40px;
}

.audio.loading::after {
    content: ' Loading...';
    font-size: 1em;
    color: #6e45e2;
    animation: blink 1s linear infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.separator {
    display: inline-block;
    margin-left: 10px;
    color: #6e45e2;
    font-size: 1.2em;
}

.buttons {
    margin-top: 40px;
    text-align: center;
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

.buttons button {
    background: var(--secondary-gradient);
    color: var(--light-text);
    border: none;
    padding: 15px 30px;
    font-size: 1em;
    font-weight: 500;
    cursor: pointer;
    border-radius: 30px;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.buttons button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

.buttons i {
    font-size: 1.2em;
}

.loader {
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 5px solid #6e45e2;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin: 50px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Dark mode styles */
body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
}

body.dark-mode .header-content {
    background: linear-gradient(135deg, #3a1f5d, #25424f);
}

body.dark-mode #surah-content {
    background: rgba(30, 30, 40, 0.85);
}

body.dark-mode .ayah-container {
    background: rgba(40, 40, 50, 0.7);
}

body.dark-mode .ayah {
    color: #e0e0e0;
    border-bottom: 1px solid rgba(110, 69, 226, 0.2);
}

body.dark-mode .ayah.playing {
    background: rgba(110, 69, 226, 0.2);
}

body.dark-mode .translation {
    color: #cccccc;
    background-color: rgba(40, 40, 50, 0.5);
}

body.dark-mode .audio-controls {
    background-color: rgba(40, 40, 50, 0.5);
}

body.dark-mode .buttons button {
    background: linear-gradient(135deg, #3a1f5d, #4f2e7a);
}

body.dark-mode h2 {
    color: #a391e0;
}

@media (max-width: 768px) {
    .container {
        padding: 20px 15px;
    }

    h1 {
        font-size: 2.2em;
    }

    .ayah {
        font-size: 1.5em;
        padding: 15px;
    }

    .translation {
        padding: 15px;
    }

    .audio-controls {
        padding: 0 15px 15px;
    }

    .buttons {
        flex-direction: column;
        align-items: center;
    }

    .buttons button {
        width: 100%;
        max-width: 300px;
    }
}
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Surah Yaseen</h1>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search for an Ayah...">
                    <button id="search-button"><i class="fas fa-search"></i> Search</button>
                </div>
                <i id="dark-mode-toggle" class="fas fa-moon"></i>
            </div>
        </header>
        <div id="surah-content"></div>
        <div class="loader" id="loader"></div>
        <div class="buttons">
            <button id="repeat-surah"><i class="fas fa-redo"></i> Repeat Surah</button>
            <button id="next-surah"><i class="fas fa-arrow-right"></i> Next Surah</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Initialize particles
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS("particles-js", {
                    "particles": {
                        "number": {
                            "value": 80,
                            "density": {
                                "enable": true,
                                "value_area": 800
                            }
                        },
                        "color": {
                            "value": "#6e45e2"
                        },
                        "shape": {
                            "type": "circle",
                            "stroke": {
                                "width": 0,
                                "color": "#000000"
                            },
                            "polygon": {
                                "nb_sides": 5
                            }
                        },
                        "opacity": {
                            "value": 0.5,
                            "random": false,
                            "anim": {
                                "enable": false,
                                "speed": 1,
                                "opacity_min": 0.1,
                                "sync": false
                            }
                        },
                        "size": {
                            "value": 3,
                            "random": true,
                            "anim": {
                                "enable": false,
                                "speed": 40,
                                "size_min": 0.1,
                                "sync": false
                            }
                        },
                        "line_linked": {
                            "enable": true,
                            "distance": 150,
                            "color": "#a391e0",
                            "opacity": 0.4,
                            "width": 1
                        },
                        "move": {
                            "enable": true,
                            "speed": 2,
                            "direction": "none",
                            "random": false,
                            "straight": false,
                            "out_mode": "out",
                            "bounce": false,
                            "attract": {
                                "enable": false,
                                "rotateX": 600,
                                "rotateY": 1200
                            }
                        }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": {
                            "onhover": {
                                "enable": true,
                                "mode": "grab"
                            },
                            "onclick": {
                                "enable": true,
                                "mode": "push"
                            },
                            "resize": true
                        },
                        "modes": {
                            "grab": {
                                "distance": 140,
                                "line_linked": {
                                    "opacity": 1
                                }
                            },
                            "bubble": {
                                "distance": 400,
                                "size": 40,
                                "duration": 2,
                                "opacity": 8,
                                "speed": 3
                            },
                            "repulse": {
                                "distance": 200,
                                "duration": 0.4
                            },
                            "push": {
                                "particles_nb": 4
                            },
                            "remove": {
                                "particles_nb": 2
                            }
                        }
                    },
                    "retina_detect": true
                });
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            const surahContent = document.getElementById('surah-content');
            const loader = document.getElementById('loader');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const repeatSurahButton = document.getElementById('repeat-surah');
            const nextSurahButton = document.getElementById('next-surah');
            let autoNextSurahTimeout;
            let wakeLock = null;

            async function requestWakeLock() {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake lock is active');
                } catch (err) {
                    console.error(`${err.name}, ${err.message}`);
                }
            }

            function releaseWakeLock() {
                if (wakeLock) {
                    wakeLock.release().then(() => {
                        wakeLock = null;
                        console.log('Wake lock released');
                    });
                }
            }

            function handleVisibilityChange() {
                if (document.visibilityState === 'visible') {
                    requestWakeLock();
                } else {
                    releaseWakeLock();
                }
            }

            document.addEventListener('visibilitychange', handleVisibilityChange);
            requestWakeLock();

            // Check for saved theme preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                darkModeToggle.classList.remove('fa-moon');
                darkModeToggle.classList.add('fa-sun');
            }

            function loadSurah(surahNumber) {
                surahContent.style.display = 'none';
                loader.style.display = 'block';

                Swal.fire({
                    title: 'Loading Surah Yaseen',
                    html: 'Please wait...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    },
                    background: document.body.classList.contains('dark-mode') ? '#2d2d3a' : '#ffffff',
                    color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333333'
                });

                Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/36`),
                    fetch(`https://api.alquran.cloud/v1/surah/36/en.sahih`),
                    fetch(`https://api.alquran.cloud/v1/surah/36/ar.alafasy`)
                ])
                .then(responses => Promise.all(responses.map(response => response.json())))
                .then(([surahData, translationData, audioData]) => {
                    loader.style.display = 'none';
                    Swal.close();
                    surahContent.style.display = 'block';

                    surahContent.innerHTML = `
                        <h2>${surahData.data.englishName} (${surahData.data.name})</h2>
                        <p>${surahData.data.englishNameTranslation}</p>
                        ${surahData.data.ayahs.map((ayah, index) => `
                            <div class="ayah" id="ayah-${index}">
                                ${ayah.text}<span class="separator">۞</span>
                            </div>
                            <div class="translation" id="translation-${index}">
                                ${translationData.data.ayahs[index].text}
                            </div>
                            <audio class="audio" id="audio-${index}" controls>
                                <source src="${audioData.data.ayahs[index].audio}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>`).join('')}
                    `;

                    const audios = document.querySelectorAll('.audio');
                    const ayahs = document.querySelectorAll('.ayah');

                    audios.forEach((audio, index) => {
                        audio.addEventListener('play', () => {
                            ayahs.forEach(ayah => ayah.classList.remove('playing'));
                            document.getElementById('ayah-' + index).classList.add('playing');
                            scrollToAyah(index);
                        });

                        audio.addEventListener('waiting', () => {
                            audio.classList.add('loading');
                        });

                        audio.addEventListener('playing', () => {
                            audio.classList.remove('loading');
                        });

                        audio.addEventListener('ended', () => {
                            if (index < audios.length - 1) {
                                audios[index + 1].play();
                            } else {
                                autoNextSurah();
                            }
                        });
                    });

                    audios[0].play();
                })
                .catch(error => {
                    Swal.close();
                    console.error('Error fetching surah:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Something went wrong! Please check your connection and try again.',
                        background: document.body.classList.contains('dark-mode') ? '#2d2d3a' : '#ffffff',
                        color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333333'
                    });
                });
            }

            function scrollToAyah(index) {
                const ayahElement = document.getElementById(`ayah-${index}`);
                ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            function autoNextSurah() {
                clearTimeout(autoNextSurahTimeout);
                autoNextSurahTimeout = setTimeout(() => {
                    const nextSurahNumber = parseInt(surahNumber) + 1;
                    if (nextSurahNumber > 114) {
                        Swal.fire({
                            title: 'End of Quran',
                            text: 'You have reached the end of the Quran.',
                            icon: 'info',
                            background: document.body.classList.contains('dark-mode') ? '#2d2d3a' : '#ffffff',
                            color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333333'
                        });
                        return;
                    }
                    window.location.href = `surah.html?surah=${nextSurahNumber}`;
                }, 3000);
            }

            function getSurahNumber() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('surah') || '36'; // Default to Surah Yaseen (36) if not specified
            }

            const surahNumber = getSurahNumber();
            loadSurah(surahNumber);

            repeatSurahButton.addEventListener('click', () => {
                clearTimeout(autoNextSurahTimeout);
                loadSurah(surahNumber);
            });

            nextSurahButton.addEventListener('click', () => {
                clearTimeout(autoNextSurahTimeout);
                const nextSurahNumber = parseInt(surahNumber) + 1;
                if (nextSurahNumber > 114) {
                    Swal.fire({
                        title: 'End of Quran',
                        text: 'You have reached the end of the Quran.',
                        icon: 'info',
                        background: document.body.classList.contains('dark-mode') ? '#2d2d3a' : '#ffffff',
                        color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333333'
                    });
                    return;
                }
                window.location.href = `surah.html?surah=${nextSurahNumber}`;
            });

            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                if (!searchTerm) return;
                
                const translations = document.querySelectorAll('.translation');
                const ayahs = document.querySelectorAll('.ayah');
                
                let found = false;
                
                translations.forEach((translation, index) => {
                    const translationText = translation.innerText.toLowerCase();
                    const ayah = ayahs[index];
                    
                    if (translationText.includes(searchTerm)) {
                        translation.style.display = 'block';
                        ayah.style.display = 'block';
                        
                        // Highlight the first match
                        if (!found) {
                            found = true;
                            ayah.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            
                            // Add a temporary highlight effect
                            ayah.style.boxShadow = '0 0 0 3px #6e45e2';
                            setTimeout(() => {
                                ayah.style.boxShadow = '';
                            }, 3000);
                        }
                    } else {
                        translation.style.display = 'none';
                        ayah.style.display = 'none';
                    }
                });
                
                if (!found) {
                    Swal.fire({
                        title: 'No Results',
                        text: `No matches found for "${searchTerm}"`,
                        icon: 'info',
                        background: document.body.classList.contains('dark-mode') ? '#2d2d3a' : '#ffffff',
                        color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333333'
                    });
                }
            }

            darkModeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                
                if (document.body.classList.contains('dark-mode')) {
                    darkModeToggle.classList.remove('fa-moon');
                    darkModeToggle.classList.add('fa-sun');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    darkModeToggle.classList.remove('fa-sun');
                    darkModeToggle.classList.add('fa-moon');
                    localStorage.setItem('darkMode', 'false');
                }
            });
        });
    </script>
</body>
</html>

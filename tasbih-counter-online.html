<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Tasbih - Prayer Counter</title>
    <style>
        :root {
    --primary-gradient: linear-gradient(135deg, #6e45e2 0%, #88d3ce 100%);
    --primary-color: #6e45e2;
    --secondary-color: #88d3ce;
    --text-color: #333;
    --bg-color: #f9f9f9;
    --card-bg: white;
    --shadow-color: rgba(0, 0, 0, 0.1);
    --button-hover: #5a36c9;
    --sidebar-width: 250px;
    --counter-bg: #00ff7f;
    --counter-text: #000;
}

.dark-mode {
    --primary-gradient: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
    --primary-color: #8b5cf6;
    --secondary-color: #3b82f6;
    --text-color: #e0e0e0;
    --bg-color: #121212;
    --card-bg: #1e1e1e;
    --shadow-color: rgba(0, 0, 0, 0.5);
    --button-hover: #7c4dff;
    --counter-bg: #00aa55;
    --counter-text: #000;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    transition: background-color 0.3s, color 0.3s;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    overflow-x: hidden;
}

/* Sidebar Styles - Improved Responsiveness */
.sidebar {
    width: var(--sidebar-width);
    background: var(--card-bg);
    box-shadow: 2px 0 10px var(--shadow-color);
    padding: 20px;
    position: fixed;
    height: 100%;
    left: -280px; /* Move it further off screen */
    top: 0;
    z-index: 999;
    transition: left 0.3s ease;
    overflow-y: auto; /* Allow scrolling for smaller screens */
}

.sidebar.open {
    left: 0;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.sidebar h2 {
    font-size: 1.5rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

.close-sidebar {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-color);
}

.sidebar-section {
    margin-bottom: 20px;
}

.sidebar-section h3 {
    margin-bottom: 10px;
    font-size: 1rem;
}

.preset-buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 columns for smaller screens */
    gap: 8px;
}

.preset-btn {
    background: var(--card-bg);
    border: 1px solid var(--primary-color);
    color: var(--text-color);
    padding: 8px 5px;
    border-radius: 5px;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.preset-btn:hover {
    background: var(--primary-gradient);
    color: white;
}

.settings-option {
    margin-bottom: 15px;
}

.settings-option label {
    display: block;
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.settings-option input,
.settings-option select {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid var(--secondary-color);
    background-color: var(--card-bg);
    color: var(--text-color);
}

.ad-container {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 10px;
    margin-top: 20px;
    text-align: center;
    border: 1px dashed var(--secondary-color);
}

.ad-container p {
    font-size: 0.8rem;
    opacity: 0.7;
}

.main-content {
    flex: 1;
    margin-left: 0;
    transition: margin-left 0.3s ease;
    width: 100%;
}

.sidebar-open .main-content {
    margin-left: var(--sidebar-width);
}

.header {
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: var(--card-bg);
    box-shadow: 0 2px 10px var(--shadow-color);
    position: sticky;
    top: 0;
    z-index: 100;
}

.menu-button {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-color);
}

.theme-toggle {
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
}

.theme-toggle:hover {
    opacity: 0.9;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Digital Counter Styles */
.tasbih-container {
    background-color: #000; /* Black background as in the image */
    border-radius: 40px; /* Rounded like the device in image */
    box-shadow: 0 10px 30px var(--shadow-color);
    padding: 30px;
    width: 100%;
    max-width: 350px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 3px solid #111;
}

.tasbih-title {
    font-size: 1.8rem;
    margin-bottom: 10px;
    position: relative;
    z-index: 1;
    color: white;
}

.counter-display-container {
    background-color: var(--counter-bg);
    border-radius: 8px;
    padding: 5px;
    margin: 15px auto;
    max-width: 220px;
    border: 2px solid rgba(0, 0, 0, 0.3);
}

.counter-display {
    font-family: 'Digital-7', 'LCD', monospace;
    font-size: 5rem;
    font-weight: bold;
    color: var(--counter-text);
    position: relative;
    z-index: 1;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
    margin: 0;
    padding: 5px;
}

.dhikr-name {
    font-size: 1.2rem;
    margin-bottom: 20px;
    position: relative;
    z-index: 1;
    color: white;
}

.control-button {
    width: 30px;
    height: 30px;
    background-color: #ccc;
    border-radius: 50%;
    display: inline-block;
    margin: 5px 10px;
    cursor: pointer;
    border: 2px solid #999;
}

.main-button {
    width: 80px;
    height: 80px;
    background-color: #ddd;
    border-radius: 50%;
    margin: 15px auto;
    cursor: pointer;
    border: 4px solid #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
}

.progress-container {
    width: 100%;
    height: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    margin-bottom: 20px;
    position: relative;
    z-index: 1;
}

.progress-bar {
    height: 100%;
    border-radius: 5px;
    background: var(--primary-gradient);
    width: 0%;
    transition: width 0.3s ease;
}

.counter-stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    position: relative;
    z-index: 1;
    color: white;
}

.stat {
    text-align: center;
    flex: 1;
}

.stat-title {
    font-size: 0.8rem;
    opacity: 0.7;
}

.stat-value {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--secondary-color);
}

.buttons-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 20px;
    position: relative;
    z-index: 1;
}

.main-btn {
    padding: 15px;
    border-radius: 15px;
    border: none;
    background: var(--primary-gradient);
    color: white;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: transform 0.1s, box-shadow 0.1s;
}

.main-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
}

.main-btn:active {
    transform: translateY(1px);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.count-btn {
    grid-column: span 3;
    height: 80px;
    font-size: 1.5rem;
    border-radius: 20px;
}

.count-btn:active {
    animation: pulse 0.3s ease;
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(0.98);
    }
    100% {
        transform: scale(1);
    }
}

.ripple {
    position: absolute;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.4);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

.vibrate {
    animation: vibrate 0.3s linear;
}

@keyframes vibrate {
    0% {
        transform: translate(0);
    }
    20% {
        transform: translate(-2px, 2px);
    }
    40% {
        transform: translate(-2px, -2px);
    }
    60% {
        transform: translate(2px, 2px);
    }
    80% {
        transform: translate(2px, -2px);
    }
    100% {
        transform: translate(0);
    }
}

.recent-activities {
    margin-top: 30px;
    width: 100%;
    max-width: 500px;
    background-color: var(--card-bg);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px var(--shadow-color);
}

.activities-title {
    margin-bottom: 15px;
    font-size: 1.2rem;
}

.activity-list {
    list-style: none;
}

.activity-item {
    padding: 10px 0;
    border-bottom: 1px solid rgba(128, 128, 128, 0.2);
    display: flex;
    justify-content: space-between;
}

.activity-date {
    font-size: 0.8rem;
    opacity: 0.7;
}

.export-btn {
    margin-top: 15px;
    background: var(--primary-gradient);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
}

.floating-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary-gradient);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    z-index: 100;
    transition: transform 0.3s;
}

.floating-button:hover {
    transform: scale(1.1);
}

/* Sound indicator */
.sound-indicator {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.2rem;
    color: white;
    opacity: 0.7;
    cursor: pointer;
}

/* Responsive styles */
@media (min-width: 769px) {
    .preset-buttons {
        grid-template-columns: repeat(3, 1fr); /* 3 columns for larger screens */
    }
}

@media (max-width: 768px) {
    .container {
        padding: 10px;
    }

    .tasbih-container {
        padding: 20px;
        border-radius: 30px;
    }

    .counter-display {
        font-size: 4rem;
    }

    .buttons-container {
        gap: 10px;
    }

    .main-btn {
        padding: 12px;
    }

    .count-btn {
        height: 70px;
    }

    .floating-button {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
    }
    
    /* Prevent sidebar from pushing content when open on mobile */
    .sidebar-open .main-content {
        margin-left: 0;
        opacity: 0.6; /* Dim the main content when sidebar is open */
    }
}

@media (max-width: 480px) {
    .tasbih-container {
        padding: 15px;
    }
    
    .counter-display {
        font-size: 3.5rem;
    }
    
    .counter-stats {
        flex-direction: column;
        gap: 10px;
    }
    
    .buttons-container {
        grid-template-columns: 1fr 1fr;
    }
    
    .count-btn {
        grid-column: span 2;
    }
}

/* Loader animation */
.loader {
    display: inline-block;
    position: relative;
    width: 80px;
    height: 80px;
    margin: 20px auto;
}

.loader div {
    position: absolute;
    border: 4px solid var(--primary-color);
    opacity: 1;
    border-radius: 50%;
    animation: loader 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
}

.loader div:nth-child(2) {
    animation-delay: -0.5s;
}

@keyframes loader {
    0% {
        top: 36px;
        left: 36px;
        width: 0;
        height: 0;
        opacity: 1;
    }
    100% {
        top: 0px;
        left: 0px;
        width: 72px;
        height: 72px;
        opacity: 0;
    }
}

/* Add a font for the digital display */
@font-face {
    font-family: 'Digital-7';
    src: url('https://cdnjs.cloudflare.com/ajax/libs/digital-7-font/1.0.0/digital-7.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Digital Tasbih</h2>
            <button class="close-sidebar" id="closeSidebar">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="sidebar-section">
            <h3>Preset Dhikr</h3>
            <div class="preset-buttons">
                <button class="preset-btn" data-name="SubhanAllah" data-target="33">SubhanAllah</button>
                <button class="preset-btn" data-name="Alhamdulillah" data-target="33">Alhamdulillah</button>
                <button class="preset-btn" data-name="Allahu Akbar" data-target="33">Allahu Akbar</button>
                <button class="preset-btn" data-name="La ilaha illallah" data-target="100">La ilaha illallah</button>
                <button class="preset-btn" data-name="Astaghfirullah" data-target="100">Astaghfirullah</button>
                <button class="preset-btn" data-name="Salawat" data-target="100">Salawat</button>
                <button class="preset-btn" data-name="Custom" data-target="0">Custom</button>
            </div>
        </div>

        <div class="sidebar-section">
            <h3>Settings</h3>
            <div class="settings-option">
                <label for="customDhikr">Custom Dhikr Name:</label>
                <input type="text" id="customDhikr" placeholder="Enter dhikr name">
            </div>
            <div class="settings-option">
                <label for="targetCount">Target Count:</label>
                <input type="number" id="targetCount" min="1" value="33">
            </div>
            <div class="settings-option">
                <label for="vibrateOption">Vibration:</label>
                <select id="vibrateOption">
                    <option value="off">Off</option>
                    <option value="light">Light</option>
                    <option value="strong">Strong</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="soundOption">Sound:</label>
                <select id="soundOption">
                    <option value="off">Off</option>
                    <option value="click">Click</option>
                    <option value="beep">Beep</option>
                    <option value="dhikr">Dhikr Sound</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="autoReset">Auto Reset:</label>
                <select id="autoReset">
                    <option value="off">Off</option>
                    <option value="on">On Target Completion</option>
                </select>
            </div>
        </div>

        <div class="ad-container">
            <p>Ad Space Available</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="header">
            <button class="menu-button" id="menuButton">
                <i class="fas fa-bars"></i>
            </button>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Dark Mode</span>
            </button>
        </div>

       <!-- Update this section in the HTML file -->
<div class="tasbih-container" id="tasbihContainer">
    <div class="sound-indicator" id="soundIndicator">
        <i class="fas fa-volume-mute"></i>
    </div>
    <h1 class="tasbih-title">Digital Tasbih</h1>
    <div class="dhikr-name" id="dhikrName">SubhanAllah</div>
    
    <div class="counter-display-container">
        <div class="counter-display" id="counter">0</div>
    </div>
    
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <div class="counter-stats">
        <div class="stat">
            <div class="stat-title">Target</div>
            <div class="stat-value" id="targetValue">33</div>
        </div>
        <div class="stat">
            <div class="stat-title">Sets Completed</div>
            <div class="stat-value" id="setsValue">0</div>
        </div>
        <div class="stat">
            <div class="stat-title">Total</div>
            <div class="stat-value" id="totalValue">0</div>
        </div>
    </div>
    
    <div class="buttons-container">
        <button class="main-btn" id="resetBtn">
            <i class="fas fa-redo-alt"></i> Reset
        </button>
        <button class="main-btn" id="undoBtn">
            <i class="fas fa-undo"></i> Undo
        </button>
        <button class="main-btn" id="saveBtn">
            <i class="fas fa-save"></i> Save
        </button>
        <button class="main-btn count-btn" id="countBtn">
            Count
        </button>
    </div>
</div>

            <div class="recent-activities">
                <h2 class="activities-title">Recent Activities</h2>
                <ul class="activity-list" id="activityList">
                    <!-- Activities will be added here dynamically -->
                </ul>
                <button class="export-btn" id="exportBtn">
                    <i class="fas fa-file-export"></i> Export History
                </button>
            </div>
        </div>

        <div class="floating-button" id="quickCount">
            <i class="fas fa-plus"></i>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const menuButton = document.getElementById('menuButton');
            const closeSidebar = document.getElementById('closeSidebar');
            const themeToggle = document.getElementById('themeToggle');
            const countBtn = document.getElementById('countBtn');
            const resetBtn = document.getElementById('resetBtn');
            const undoBtn = document.getElementById('undoBtn');
            const saveBtn = document.getElementById('saveBtn');
            const quickCount = document.getElementById('quickCount');
            const exportBtn = document.getElementById('exportBtn');
            const dhikrName = document.getElementById('dhikrName');
            const presetButtons = document.querySelectorAll('.preset-btn');
            const customDhikrInput = document.getElementById('customDhikr');
            const targetCountInput = document.getElementById('targetCount');
            const soundOption = document.getElementById('soundOption');
            const vibrateOption = document.getElementById('vibrateOption');
            const autoResetOption = document.getElementById('autoReset');
            const counter = document.getElementById('counter');
            const progressBar = document.getElementById('progressBar');
            const targetValue = document.getElementById('targetValue');
            const setsValue = document.getElementById('setsValue');
            const totalValue = document.getElementById('totalValue');
            const activityList = document.getElementById('activityList');
            const tasbihContainer = document.getElementById('tasbihContainer');
            const soundIndicator = document.getElementById('soundIndicator');

            // App state
            let count = 0;
            let targetCount = 33;
            let totalCount = 0;
            let setsCompleted = 0;
            let countHistory = [];
            let activities = [];
            let currentDhikr = "SubhanAllah";
            let isDarkMode = false;

            // Audio elements
            const clickSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAFOwCSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKS//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQhAAAAAAAABTsZq0DzAAAAAAD/+xDEAAAIIANvtBAAJaRG7vZ4YgIqTrBYkNIEAIAwmCgwx0Jzw8P//y8PD/4eHh+HJ//g8PD4PD8usK/w+D+X///8Hh+Hh+oGAAAAYRhjGtZoMxBgANAWxg+gfMDLGUiOGALxQbFgFhhdgRABOGC8gRMB4CYkHZAAABHDQZ//2//X/9luzSt2QSyNw+ebpMmTJ9PTQz/mNNPIxJm7W7/Z/+xxoAAAAAA=');
            const beepSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAEbwC1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAWqAAAAAAAABG+uXbfNAAAAAAD/+xDEAAAHbAN/tAAAJZfHjn8zgAA6AMAAIAAYIIKqrAYEBwgCxYkP8vOP/5znP//4f/KOf/8uQ5znOXIcQA5znP+Q5zn/IcoAALBYHg8T8eD5QA8Hg8E/Hg+UHwfD4P//B/8Hg/g+D4fB4Ph8Hg+DwfAPB8Hg+DwfB8qAeD4fB8Hg+VAKoAAAT4Pg+D5PkwfLgGQAAAAA=');
            const dhikrSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAADAAAJhwDMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz///////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJANEAAAAAAAACYew4+YIAAAAAAD/+xDEAAAJcAFn9BAAKViPLP53gCIOCQwMIIBoOAIPBAMBAIfB8H4CQEgJAPgPD4Ph//8Hz//wf/lCEIQhCAuCDgQCHggGAgEDg+DwfB+AgA+D8BICQEgHwHh8Hg//8Hg+H//g//KAuC4LgAKAgGBAEAwIAQDBAdBAMIIDoGDg+AgA+A8BAIAQD4DweD4P//B4Ph//4P/yAYEAQAFAXD8P///w+f/4P/D8P//3/h//+D59AKAAAAGDh+Hz6AYDAYDAZg4fh8+gGA==');

            // Initialize
            loadSettings();
            updateDisplay();
            renderActivities();

            // Event Listeners
            menuButton.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', closeSidebarMenu);
            themeToggle.addEventListener('click', toggleTheme);
            countBtn.addEventListener('click', incrementCount);
            resetBtn.addEventListener('click', resetCounter);
            undoBtn.addEventListener('click', undoCount);
            saveBtn.addEventListener('click', saveSession);
            quickCount.addEventListener('click', incrementCount);
            exportBtn.addEventListener('click', exportHistory);
            soundIndicator.addEventListener('click', toggleSound);

            presetButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const name = button.getAttribute('data-name');
                    const target = parseInt(button.getAttribute('data-target'));
                    
                    if (name === 'Custom') {
                        currentDhikr = customDhikrInput.value || 'Custom Dhikr';
                        targetCount = parseInt(targetCountInput.value) || 33;
                    } else {
                        currentDhikr = name;
                        targetCount = target;
                        targetCountInput.value = target;
                    }
                    
                    resetCounter();
                    updateDisplay();
                    saveSettings();
                    closeSidebarMenu();
                });
            });

            customDhikrInput.addEventListener('input', () => {
                if (currentDhikr === 'Custom Dhikr' || currentDhikr === 'Custom') {
                    currentDhikr = customDhikrInput.value || 'Custom Dhikr';
                    dhikrName.textContent = currentDhikr;
                    saveSettings();
                }
            });

            targetCountInput.addEventListener('change', () => {
                targetCount = parseInt(targetCountInput.value) || 33;
                targetValue.textContent = targetCount;
                updateProgressBar();
                saveSettings();
            });

            soundOption.addEventListener('change', saveSettings);
            vibrateOption.addEventListener('change', saveSettings);
            autoResetOption.addEventListener('change', saveSettings);

            // Functions
            function toggleSidebar() {
                sidebar.classList.toggle('open');
                mainContent.classList.toggle('sidebar-open');
            }

            function closeSidebarMenu() {
                sidebar.classList.remove('open');
                mainContent.classList.remove('sidebar-open');
            }

            function toggleTheme() {
                isDarkMode = !isDarkMode;
                document.body.classList.toggle('dark-mode', isDarkMode);
                
                const icon = themeToggle.querySelector('i');
                const text = themeToggle.querySelector('span');
                
                if (isDarkMode) {
                    icon.className = 'fas fa-sun';
                    text.textContent = 'Light Mode';
                } else {
                    icon.className = 'fas fa-moon';
                    text.textContent = 'Dark Mode';
                }
                
                saveSettings();
            }

            function toggleSound() {
                const nextOption = {
                    'off': 'click',
                    'click': 'beep',
                    'beep': 'dhikr',
                    'dhikr': 'off'
                };
                
                soundOption.value = nextOption[soundOption.value];
                updateSoundIndicator();
                saveSettings();
            }

            function updateSoundIndicator() {
                const icon = soundIndicator.querySelector('i');
                
                switch(soundOption.value) {
                    case 'off':
                        icon.className = 'fas fa-volume-mute';
                        break;
                    case 'click':
                        icon.className = 'fas fa-volume-down';
                        break;case 'beep':
                        icon.className = 'fas fa-volume-up';
                        break;
                    case 'dhikr':
                        icon.className = 'fas fa-pray';
                        break;
                }
            }

            function incrementCount(event) {
                // Add ripple effect if click event exists
                if (event && event.type === 'click') {
                    createRipple(event);
                }
                
                count++;
                totalCount++;
                countHistory.push({
                    dhikr: currentDhikr,
                    timestamp: new Date().toISOString()
                });
                
                // Play sound based on setting
                playSound();
                
                // Vibrate based on setting
                vibrate();
                
                // Check if target is reached
                if (count >= targetCount) {
                    setsCompleted++;
                    addActivity(`Completed ${targetCount} ${currentDhikr}`);
                    
                    // Auto reset if enabled
                    if (autoResetOption.value === 'on') {
                        count = 0;
                    }
                }
                
                updateDisplay();
                saveSettings();
            }

            function resetCounter() {
                if (count > 0) {
                    addActivity(`Reset counter at ${count} of ${currentDhikr}`);
                }
                count = 0;
                updateDisplay();
                saveSettings();
            }

            function undoCount() {
                if (count > 0) {
                    count--;
                    totalCount--;
                    countHistory.pop();
                    updateDisplay();
                    saveSettings();
                } else {
                    tasbihContainer.classList.add('vibrate');
                    setTimeout(() => {
                        tasbihContainer.classList.remove('vibrate');
                    }, 300);
                }
            }

            function createRipple(event) {
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                const ripple = document.createElement('span');
                ripple.classList.add('ripple');
                ripple.style.top = `${y}px`;
                ripple.style.left = `${x}px`;
                
                button.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }

            function updateDisplay() {
                counter.textContent = count;
                targetValue.textContent = targetCount;
                setsValue.textContent = setsCompleted;
                totalValue.textContent = totalCount;
                dhikrName.textContent = currentDhikr;
                updateProgressBar();
                updateSoundIndicator();
            }

            function updateProgressBar() {
                const percentage = (count / targetCount) * 100;
                progressBar.style.width = `${Math.min(100, percentage)}%`;
            }

            function playSound() {
                switch(soundOption.value) {
                    case 'click':
                        clickSound.currentTime = 0;
                        clickSound.play().catch(e => console.log('Error playing sound:', e));
                        break;
                    case 'beep':
                        beepSound.currentTime = 0;
                        beepSound.play().catch(e => console.log('Error playing sound:', e));
                        break;
                    case 'dhikr':
                        dhikrSound.currentTime = 0;
                        dhikrSound.play().catch(e => console.log('Error playing sound:', e));
                        break;
                }
            }

            function vibrate() {
                if ('vibrate' in navigator) {
                    switch(vibrateOption.value) {
                        case 'light':
                            navigator.vibrate(20);
                            break;
                        case 'strong':
                            navigator.vibrate(50);
                            break;
                    }
                }
            }

            function saveSession() {
                if (count > 0 || setsCompleted > 0) {
                    addActivity(`Saved session: ${currentDhikr} - ${count} count(s), ${setsCompleted} set(s)`);
                    saveSettings();
                    
                    // Display confirmation animation
                    const saveAnimation = document.createElement('div');
                    saveAnimation.innerHTML = '<i class="fas fa-check" style="color: var(--secondary-color); font-size: 2rem;"></i>';
                    saveAnimation.style.position = 'absolute';
                    saveAnimation.style.top = '50%';
                    saveAnimation.style.left = '50%';
                    saveAnimation.style.transform = 'translate(-50%, -50%)';
                    saveAnimation.style.background = 'rgba(0, 0, 0, 0.7)';
                    saveAnimation.style.borderRadius = '50%';
                    saveAnimation.style.width = '80px';
                    saveAnimation.style.height = '80px';
                    saveAnimation.style.display = 'flex';
                    saveAnimation.style.justifyContent = 'center';
                    saveAnimation.style.alignItems = 'center';
                    saveAnimation.style.zIndex = '1000';
                    
                    tasbihContainer.appendChild(saveAnimation);
                    
                    setTimeout(() => {
                        saveAnimation.remove();
                    }, 1000);
                }
            }

            function addActivity(description) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                const dateStr = now.toLocaleDateString();
                
                activities.unshift({
                    description,
                    time: timeStr,
                    date: dateStr,
                    timestamp: now.getTime()
                });
                
                // Limit to last 10 activities
                if (activities.length > 10) {
                    activities.pop();
                }
                
                renderActivities();
                saveSettings();
            }

            function renderActivities() {
                activityList.innerHTML = '';
                
                if (activities.length === 0) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'activity-item';
                    emptyItem.textContent = 'No recent activity';
                    activityList.appendChild(emptyItem);
                    return;
                }
                
                activities.forEach(activity => {
                    const item = document.createElement('li');
                    item.className = 'activity-item';
                    
                    const desc = document.createElement('div');
                    desc.textContent = activity.description;
                    
                    const time = document.createElement('div');
                    time.className = 'activity-date';
                    time.textContent = `${activity.time} • ${activity.date}`;
                    
                    item.appendChild(desc);
                    item.appendChild(time);
                    activityList.appendChild(item);
                });
            }

            function exportHistory() {
                // Create CSV content
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Date,Time,Description\n";
                
                activities.forEach(activity => {
                    csvContent += `${activity.date},${activity.time},"${activity.description}"\n`;
                });
                
                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', `tasbih_history_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                
                // Trigger download
                link.click();
                document.body.removeChild(link);
                
                // Show notification
                const notification = document.createElement('div');
                notification.textContent = 'Export successful!';
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.left = '50%';
                notification.style.transform = 'translateX(-50%)';
                notification.style.background = 'var(--primary-gradient)';
                notification.style.color = 'white';
                notification.style.padding = '10px 20px';
                notification.style.borderRadius = '20px';
                notification.style.zIndex = '1000';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 2000);
            }

            function saveSettings() {
                const settings = {
                    count,
                    targetCount,
                    totalCount,
                    setsCompleted,
                    countHistory,
                    activities,
                    currentDhikr,
                    soundSetting: soundOption.value,
                    vibrateSetting: vibrateOption.value,
                    autoResetSetting: autoResetOption.value,
                    isDarkMode
                };
                
                localStorage.setItem('tasbihSettings', JSON.stringify(settings));
            }

            function loadSettings() {
                const savedSettings = localStorage.getItem('tasbihSettings');
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    count = settings.count || 0;
                    targetCount = settings.targetCount || 33;
                    totalCount = settings.totalCount || 0;
                    setsCompleted = settings.setsCompleted || 0;
                    countHistory = settings.countHistory || [];
                    activities = settings.activities || [];
                    currentDhikr = settings.currentDhikr || 'SubhanAllah';
                    
                    // Update form inputs
                    targetCountInput.value = targetCount;
                    soundOption.value = settings.soundSetting || 'off';
                    vibrateOption.value = settings.vibrateSetting || 'off';
                    autoResetOption.value = settings.autoResetSetting || 'off';
                    
                    // Set dark mode if saved
                    isDarkMode = settings.isDarkMode || false;
                    if (isDarkMode) {
                        document.body.classList.add('dark-mode');
                        themeToggle.querySelector('i').className = 'fas fa-sun';
                        themeToggle.querySelector('span').textContent = 'Light Mode';
                    }
                }
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // Space bar to count
                if (event.code === 'Space') {
                    incrementCount();
                    event.preventDefault();
                }
                // R key to reset
                else if (event.code === 'KeyR') {
                    resetCounter();
                }
                // Z key to undo
                else if (event.code === 'KeyZ') {
                    undoCount();
                }
                // S key to save
                else if (event.code === 'KeyS') {
                    saveSession();
                }
            });

            // Touch swipe functionality
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);
            
            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);
            
            function handleSwipe() {
                if (touchEndX < touchStartX - 100) {
                    // Swipe left - open sidebar
                    sidebar.classList.add('open');
                    mainContent.classList.add('sidebar-open');
                }
                if (touchEndX > touchStartX + 100 && sidebar.classList.contains('open')) {
                    // Swipe right - close sidebar
                    sidebar.classList.remove('open');
                    mainContent.classList.remove('sidebar-open');
                }
            }

            // Add shake to count feature
            let shakeThreshold = 15;
            let lastX = 0, lastY = 0, lastZ = 0;
            let lastUpdate = 0;
            let shakeTimeout = null;
            
            window.addEventListener('devicemotion', function(event) {
                const currentTime = new Date().getTime();
                if ((currentTime - lastUpdate) > 100) {
                    const diffTime = currentTime - lastUpdate;
                    lastUpdate = currentTime;
                    
                    const acceleration = event.accelerationIncludingGravity;
                    
                    const x = acceleration.x;
                    const y = acceleration.y;
                    const z = acceleration.z;
                    
                    const speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;
                    
                    if (speed > shakeThreshold) {
                        // Prevent multiple counts from a single shake
                        if (!shakeTimeout) {
                            incrementCount();
                            shakeTimeout = setTimeout(() => {
                                shakeTimeout = null;
                            }, 1000);
                        }
                    }
                    
                    lastX = x;
                    lastY = y;
                    lastZ = z;
                }
            }, false);
        });
    </script>
</body>
</html>

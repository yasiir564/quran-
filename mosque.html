<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Mosque Finder AI Tool</title>
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f4f8;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            color: #34495e;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .location-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        #currentLocation {
            flex-grow: 1;
            margin-right: 15px;
            padding: 10px;
            background-color: #f0f4f8;
            border-radius: 4px;
        }

        #locationBtn {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mosques-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .mosque-list {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .mosque-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .mosque-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .mosque-details {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .weather-info {
            background-color: #e6f3ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-insights {
            background-color: #f0f4f8;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-details {
            background-color: #3498db;
            color: white;
        }

        .btn-directions {
            background-color: #2ecc71;
            color: white;
        }

        @media (max-width: 768px) {
            .mosques-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🕌 Advanced Mosque Finder</h1>
        </div>

        <div class="location-section">
            <div id="currentLocation">Location not selected</div>
            <button id="locationBtn">Get My Location</button>
        </div>

        <div id="map"></div>

        <div class="mosques-container">
            <div class="mosque-list" id="mosqueList">
                <!-- Mosque cards will be dynamically inserted here -->
            </div>

            <div class="mosque-details" id="mosqueDetails">
                <p>Select a mosque to view details</p>
            </div>
        </div>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    <script>
        // Configuration
        const GOOGLE_MAPS_API_KEY = 'AlzaSyYb--F6qwmKCKqmym0lqZIz6p3TdY2qWbo';
        const GEMINI_API_KEY = 'AIzaSyBBhXs0Wd66ceLEHW6qsUjja78BSMAD9G4';
        const OPENWEATHER_API_KEY = 'YOUR_OPENWEATHER_API_KEY'; // Replace with your OpenWeatherMap API key

        // Global variables
        let map, userLocation, currentMosques = [];

        // Load Google Maps and Gemini
        function loadScripts() {
            // Load Google Maps
            const mapScript = document.createElement('script');
            mapScript.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&callback=initMap`;
            mapScript.async = true;
            document.head.appendChild(mapScript);

            // Load Gemini AI
            const geminiScript = document.createElement('script');
            geminiScript.src = "https://esm.run/@google/generative-ai";
            geminiScript.type = "module";
            document.head.appendChild(geminiScript);
        }

        // Initialize Google Maps
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 2,
                mapTypeControl: false
            });

            document.getElementById('locationBtn').addEventListener('click', getUserLocation);
        }

        // Get User Location
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        // Update location display
                        document.getElementById('currentLocation').textContent = 
                            `Latitude: ${userLocation.lat.toFixed(4)}, Longitude: ${userLocation.lng.toFixed(4)}`;

                        // Center map on user location
                        map.setCenter(userLocation);
                        map.setZoom(12);

                        // Add user location marker
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            title: 'Your Location',
                            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                        });

                        // Search for nearby mosques
                        findNearbyMosques();
                    },
                    (error) => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Location Error',
                            text: error.message
                        });
                    }
                );
            } else {
                Swal.fire({
                    icon: 'warning',
                    title: 'Geolocation Not Supported',
                    text: 'Your browser does not support geolocation.'
                });
            }
        }

        // Find Nearby Mosques
        async function findNearbyMosques() {
            const service = new google.maps.places.PlacesService(map);
            
            service.nearbySearch({
                location: userLocation,
                radius: 5000, // 5 km radius
                type: ['mosque']
            }, processMosques);
        }

        // Process Mosque Results
        function processMosques(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                currentMosques = results.map((mosque, index) => {
                    // Calculate distance from user
                    const distance = google.maps.geometry.spherical.computeDistanceBetween(
                        new google.maps.LatLng(userLocation),
                        mosque.geometry.location
                    ) / 1000; // Convert to km

                    // Add marker for each mosque
                    new google.maps.Marker({
                        position: mosque.geometry.location,
                        map: map,
                        title: mosque.name
                    });

                    return {
                        name: mosque.name,
                        location: mosque.geometry.location.toJSON(),
                        vicinity: mosque.vicinity,
                        distance: distance.toFixed(2)
                    };
                });

                renderMosqueList();
            }
        }

        // Render Mosque List
        function renderMosqueList() {
            const mosqueList = document.getElementById('mosqueList');
            
            // Sort mosques by distance
            currentMosques.sort((a, b) => a.distance - b.distance);

            mosqueList.innerHTML = currentMosques.map((mosque, index) => `
                <div class="mosque-card">
                    <div>
                        <h3>${mosque.name}</h3>
                        <p>${mosque.vicinity}</p>
                        <p>Distance: ${mosque.distance} km</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-details" onclick="showMosqueDetails(${index})">Details</button>
                        <button class="btn btn-directions" onclick="showDirections(${index})">Directions</button>
                    </div>
                </div>
            `).join('');
        }

        // Show Mosque Details
        async function showMosqueDetails(index) {
            const mosque = currentMosques[index];
            
            try {
                // Fetch weather
                const weatherData = await fetchWeather(mosque.location.lat, mosque.location.lng);
                
                // Fetch AI insights (you'll need to implement Gemini AI integration)
                const aiInsights = await generateMosqueInsights(mosque);

                document.getElementById('mosqueDetails').innerHTML = `
                    <h2>${mosque.name}</h2>
                    <p><strong>Location:</strong> ${mosque.vicinity}</p>
                    <p><strong>Distance:</strong> ${mosque.distance} km</p>

                    <div class="weather-info">
                        <div>
                            <h3>🌦️ Current Weather</h3>
                            <p>Temperature: ${weatherData.temp}°C</p>
                            <p>Conditions: ${weatherData.description}</p>
                        </div>
                        <img src="http://openweathermap.org/img/wn/${weatherData.icon}@2x.png" alt="Weather Icon">
                    </div>

                    <div class="ai-insights">
                        <h3>✨ AI Insights</h3>
                        <p>${aiInsights}</p>
                    </div>
                `;
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message
                });
            }
        }

        // Show Directions
        function showDirections(index) {
            const mosque = currentMosques[index];
            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer();
            
            directionsRenderer.setMap(map);

            directionsService.route(
                {
                    origin: new google.maps.LatLng(userLocation.lat, userLocation.lng),
                    destination: new google.maps.LatLng(mosque.location.lat, mosque.location.lng),
                    travelMode: 'DRIVING'
                },
                (response, status) => {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Directions Error',
                            text: 'Could not calculate directions'
                        });
                    }
                }
            );
        }

        // Fetch Weather
        async function fetchWeather(lat, lng) {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${OPENWEATHER_API_KEY}&units=metric`
            );
            const data = await response.json();
            
            return {
                temp: data.main.temp,
                description: data.weather[0].description,
                icon: data.weather[0].icon
            };
        }

        // Generate AI Insights (Placeholder - implement Gemini AI integration)
        async function generateMosqueInsights(mosque) {
            // This is a simplified mock implementation
            return `AI insights for ${mosque.name} are currently being developed. Our AI is gathering culturally sensitive and informative details about this mosque.`;
        }

        // Initialize the application
        loadScripts();
    </script>
</body>
</html>

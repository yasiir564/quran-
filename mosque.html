<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mosque Finder AI Tool</title>
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f4f8;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            color: #34495e;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            animation: fadeIn 1s ease-in-out;
        }

        .search-container {
            display: flex;
            margin-bottom: 30px;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        #searchInput {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #3498db;
            border-radius: 4px 0 0 4px;
            transition: all 0.3s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 5px rgba(52,152,219,0.5);
        }

        #searchBtn {
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        #searchBtn:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        .mosques-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            animation: slideUp 0.5s ease-out;
        }

        .mosque-list {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .mosque-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .mosque-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .mosque-details {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .ai-insights {
            background-color: #e6f2ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }

        .details-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .details-btn:hover {
            background-color: #27ae60;
            transform: scale(1.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .mosques-container {
                grid-template-columns: 1fr;
            }
        }

        .loading, .error {
            text-align: center;
            margin-top: 20px;
            color: #666;
            animation: fadeIn 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ•Œ Mosque Finder AI Tool</h1>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Enter city or area">
            <button id="searchBtn">Search</button>
        </div>

        <div class="mosques-container">
            <div class="mosque-list" id="mosqueList">
                <!-- Mosque cards will be dynamically inserted here -->
            </div>

            <div class="mosque-details" id="mosqueDetails">
                <p>Select a mosque to view details</p>
            </div>
        </div>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    <script type="module">
        // Configuration
        const GEMINI_API_KEY = 'AIzaSyBBhXs0Wd66ceLEHW6qsUjja78BSMAD9G4';

        // Import the functions we need from the modules
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const mosqueList = document.getElementById('mosqueList');
        const mosqueDetails = document.getElementById('mosqueDetails');

        // Initialize Gemini AI
        const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);

        // Generate mosque list for a city
        async function searchMosques() {
            const searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Oops...',
                    text: 'Please enter a city or area'
                });
                return;
            }

            // Show loading alert
            Swal.fire({
                title: 'Searching Mosques',
                html: 'Finding mosques in your area...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            mosqueList.innerHTML = '<p class="loading">Loading mosques...</p>';
            mosqueDetails.innerHTML = '<p>Select a mosque to view details</p>';

            try {
                const model = genAI.getGenerativeModel({ model: "gemini-pro" });
                
                const prompt = `Please provide a list of 10 notable mosques in ${searchTerm}. 
                For each mosque, include:
                - Name of the mosque
                - Neighborhood/area
                - A very brief description
                
                Format the response as a JSON array with these fields:
                [
                    {
                        "name": "Mosque Name",
                        "area": "Neighborhood",
                        "description": "Brief description"
                    },
                    ...
                ]
                
                Ensure the mosques are real and accurately represent the city's Islamic community.`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const mosqText = response.text();

                // Extract JSON from the response (remove any markdown or text around it)
                const jsonMatch = mosqText.match(/```json\n([\s\S]*?)\n```/);
                const mosqData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(mosqText);

                // Close loading alert
                Swal.close();

                // Render mosque cards
                renderMosqueCards(mosqData);
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: `Error searching mosques: ${error.message}`
                });
            }
        }

        // Render mosque cards
        function renderMosqueCards(mosques) {
            if (!mosques || mosques.length === 0) {
                mosqueList.innerHTML = `
                    <div class="error">
                        <h3>No mosques found ðŸ•Œ</h3>
                        <p>Try a different city or area</p>
                    </div>
                `;
                return;
            }

            mosqueList.innerHTML = mosques.map((mosque, index) => `
                <div class="mosque-card">
                    <div>
                        <h3>${mosque.name}</h3>
                        <p>${mosque.area || 'Location not specified'}</p>
                    </div>
                    <button class="details-btn" onclick="showMosqueDetails(${index})">
                        Details
                    </button>
                </div>
            `).join('');

            // Store mosques data for later retrieval
            window.currentMosques = mosques;
        }

        // Show mosque details
        async function showMosqueDetails(index) {
            try {
                // Show loading alert
                Swal.fire({
                    title: 'Loading Details',
                    html: 'Fetching mosque information...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                const mosque = window.currentMosques[index];

                // Generate detailed insights
                const model = genAI.getGenerativeModel({ model: "gemini-pro" });
                
                const prompt = `Provide a comprehensive, culturally sensitive analysis of this mosque:
                Mosque Name: ${mosque.name}
                City: ${searchInput.value.trim()}
                Area: ${mosque.area}

                Please create a detailed summary that includes:
                1. Historical significance of the mosque
                2. Architectural details and unique features
                3. Community role and importance
                4. Any notable events or cultural significance
                5. Welcoming description that respects Islamic cultural nuances`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const aiInsights = response.text();

                // Close loading alert
                Swal.close();

                mosqueDetails.innerHTML = `
                    <h2>${mosque.name}</h2>
                    <div>
                        <p><strong>Location:</strong> ${mosque.area}, ${searchInput.value.trim()}</p>
                        
                        <div class="ai-insights">
                            <h3>âœ¨ AI Insights</h3>
                            <p>${aiInsights}</p>
                        </div>

                        ${mosque.description ? `
                            <div>
                                <h3>Initial Description</h3>
                                <p>${mosque.description}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: `Error fetching details: ${error.message}`
                });
            }
        }

        // Event listeners
        searchBtn.addEventListener('click', searchMosques);
        searchInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') searchMosques();
        });

        // Expose functions to global scope
        window.showMosqueDetails = showMosqueDetails;
    </script>
    <script src="https://esm.run/@google/generative-ai"></script>
</body>
</html>
